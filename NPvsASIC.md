NP  Network Processor 网络处理器

RISC  Reduced Instruction Set Computer  精简指令集计算机

ASIC  Application Specific Integrated Circuit 特定用途集成电路

CPU Central Processing Unit 中央处理器

MIC MicroCode 微码



什么是网络处理器？网络处理器是一种专用的、可编程的硬件设备，它结合了RISC处理器的低成本、灵活性，以及ASIC芯片的速度和可扩展性。所以谈到网络处理器，就必须谈到RISC处理器和ASIC技术。

一、嵌入式RISC处理器

在最早的通用处理器的网络系统中，采用单一CPU控制系统，运行于通用处理器上的软件不足以处理高速网络，所以根据网络系统的层次和功能特性，网络设备的硬件体系结构也逐渐承载更多的处理单元，最突出的就是RISC处理器和ASIC处理单元。

选择RISC作为线卡上的嵌入式处理器，是因为RISC处理器小巧、快速、比较便宜，可以很方便的与其他硬件集成在一起，并且很容易编程。因此，这样的线卡通常包含一个PHY芯片，一个嵌入式RISC处理器，包含软件的ROM，以及用于报文存储RAM，和一个总线接口。使用嵌入式RISC处理器系统使得网络的功能特性得到极大的丰富，并且易于实现，修改速度也更加快速。

随着网络的数据速率的提高，从OC-3增长至OC-12、OC-48甚至更高的时候，嵌入式的RISC处理器就成为数据转发层面的一个瓶颈。ASIC技术因此得到推崇，在20世纪90年代中期，业界普遍的看法是：ASIC是网络系统的发展方向。因此，可以看到在那个时期的，ASIC设计人员，包括Logic设计人员，受到广泛的欢迎。

二、ASIC芯片

ASIC指的是为特定需求而定制的集成电路。网络系统中的协处理器（Coprocessor）就是ASIC的一种直接体现。每个协处理器都被设计成执行一种特定的功能；所有的协处理器在CPU，或者RISC处理器的控制下运行。由于ASIC硬件的设计和制造费用昂贵，所以ASIC设计工程师都一直在试图使得自己设计的ASIC芯片具有通用型，增强协处理器的通用型，使的协处理器可以处理多种协议，而不仅仅只处理一种帧格式，或者一个协议的辅助芯片。随着这种思想的深入，网络处理器逐渐浮出水面。

虽然ASIC芯片具有能够提高较高速率的优点，但它也有不足之处：

n  成本高

设计制造一片ASIC芯片的成本经常会超过百万美元。更为重要的是，协议标准是高层逻辑的抽象，它所定义的规范并不直接映像到硬件系统；因此，对于ASIC设计师来说，在他们将协议规范转换到硅片之前，必须花费大量的时间来学习相关的协议。而大多数的设计师缺少这方面的经验，所以构建一个网络系统专用的集成芯片就显得特别的困难。

n  投放市场的时间长

业界一个典型的ASIC的开发周期大约是18～20个月。这个过程包括设计、仿真和测试，也被成为硅片研发周期（silicon spin）或简称spin周期。

n  不易仿真

在将设计方案正式提交生产之前，ASIC设计需要依靠仿真来调试设计，但是仿真不能很好的应用于网络协议，主要的困难在于仿真的对象是集中于一些小的功能部件上，所以对于一个网络协议的仿真，需要大量复杂的包序列，需要考虑各种不同的应用场景。因此，ASIC对于协议栈进行广泛的仿真是不可行的。

n  修改的代价太大

在对ASIC设计出现的问题进行修改的时候，不仅仅是资金的花费，还涉及到硅片的研发周期的延期。因此，有时为了要修正一个很小的缺陷，也可能导致巨大的开销和时间的延误。

n  在不同产品中的重用率低

由于ASIC是定制芯片，都是为特定的系统，特定的场景使用的，所以很难在不同功能特性的产品中重用。比如：一个L2交换芯片不能应用在一个L3路由器中。

n  在不同版本中的重用受到限制

一般情况下，产品的后续版本都会附加一些新的特性，而一个功能上的小改动就可能需要对ASIC重新设计，正是牵一发而动全身呀。

n  缺少标准化的支持

由于缺少相关系统框架的标准，厂家会为各自的芯片选择相应的硬件接口。即使存在有关接口的标准，各个厂商出于对自身芯片开发体系的兼容，或设计过程中需要，往往和标准存在一定的差异性。这种硬件体系的异构性就使得ASIC芯片的应用受到限制。

ASIC的这些限制都是非常严重的，这使得网络系统设计工程师处于一个两难的进地。但是对于通用ASIC思想的深入——建立一种具有ASIC的优势，但没有其缺陷的新技术，网络处理器构成了这项新技术的基础。

三、网络处理器

网络处理器作为RISC处理器和ASIC设计的综合，正因为具有两个方面的优势，使得网络处理器成为构建网络系统的基本组件。

n  可编程性

可编程性给网络处理器带来了系统的灵活性，可以以最快的速度响应市场的需求，缩短了产品的开发周期，并可以不断的升级，及时推出新的特性，降低了系统整体的成本。

与ASIC协处理器不同，网络处理器并不受限于某种具体的协议，或者协议栈中的某一层，相反，网络处理器可以应用于任意的一种协议，也可以工作在协议栈的任一层次上。在这一点上，网络处理器更类似于常规的处理器——硬件保持固定，由软件决定网络处理器如何处理数据报文。

从系统的角度来讲，由于不需要更改硬件，这就意味着对于特定产品的不同版本之间可以实现组件重用。对于采用相同网络处理器的产品，也可以最大限度的利用已有的组件，从而降低开发成本。

n  可扩展性

可扩展性也是网络处理器的关键技术之一，它直接影响着网络处理器的处理性能。由于底层的硅片制造工艺限制了网络处理器的内核时钟频率，使得单个处理器不可能满足处理任意的数据速率。因而，网络处理器的体系结构依赖于两种扩展技术：并行操作技术与流水线技术。

并行操作可以通过网络处理器内部集成多个I/O处理器内核，或者以“时分”的方式，保证数据处理的并发和独立。

在流水线技术体系结构中，不同的处理器完成不同的功能，一个数据报文完成整个处理流程要经过多个处理器；有的时候，网络处理器只有单一的处理器内核，不能提供流水线操作，这时候可以构建一个软件流水线，软件流水线是通过在一个处理器上创建多个线程的方式来实现的。

n  指令集

网络处理器仅仅具有可编程性是不够的，还要有一套合适的指令集， 不同的厂家根据其设计的网络处理器架构不同，所采用的指令集也是大相径庭，这个应用工程师（微码开发工程师）带来了较大的难度。（注：网络处理器的编程语言被称为微码）。所以微码开发工程师必须要具备：熟悉网络系统体系结构；熟悉网络协议；另外还必须深刻理解网络处理器内部结构及其指令集系统。



SD579V2

SD579因为V1版本的BUG，导致V2版本的开发。从逻辑的开发，测试验证，到流片，前前后后已经12个月，还没有完成；这仅仅修改BUG。而数据开发部目前的EOSV4/V5版本的开发时间不到9个月。

SD598

SD598是ASIC开发最为典型的一个示例，由于一系列的原因，如工程师对标准的理解，设计过程的仿真和测试等等，使得该项目的规格一再变更，进度当然也就无法保证。从设计时，计划开发一款规格领先的EOS芯片，到目前，芯片规格已经基本没有竞争力，可以说是比较失败的。

SD599

相比前两者而言，由于前期已经有了相关的技术积累和技术参照，SD599的开发算是比较顺利的。但是项目进入开发阶段时，由于IEEE 802.1ah的标准进展，导致项目不得不停下，再行评估对该标准的支持情况。可见，小小的扰动都可以让ASIC的设计重头来过

NP34xx

EFGS从2003年开始采用网络处理器开发以来，到目前为止，已经推出5个R版本，特别是后续的R版本的开发周期基本上都在6个月左右。产品在2003年就顺利推向市场后，使得我司的EOS特性数据单板（包括MPLS特性）迅速的赢得市场的主导地位。

 

在2004年底，为了满足中国电信的MPLS对接测试，EFGS版本在4周内迅速推出满足测试需求的版本。

 

2005年11月，为了支持广州代表处 关于广州农行专线网络的需求，EFGS的微码开发工程师在3天时间内推出了紧急版本，并且没有新产生一个缺陷和问题。

 

目前（2005.12），随着MEF的业务模型在全球得到认可，MEF的认证测试也已经提上日程，网络处理器理所当然的又承担起保证MEF认证顺利通过的需求。

