端口环回测试可以检测端口的状态是否正常，网络维护工作中常用于定位端口故障。端口环回测试有本地环回测试和远端环回测试之分。

随着以太网速率的提升，PHY层的复杂度大大提高。从10G以太网开始，PHY层的多个子层开始以MMD设备的形式出现，MAC芯片内部也集成了内部PHY的功能。下文中的示意图，也采用了这种形式。

## 本地环回测试
本地环回测试中，端口向外发包，也就是从MAC层向PHY层方向发包。本地环回测试较为常见，通常分为MAC内环，PHY内环和端口外环。这几种环回测试方式简单易用，以太网设备基本都支持。

1. MAC内环
MAC内环的测试范围仅限于MAC芯片。
2. PHY内环
PHY内环测试的范围覆盖了从MAC芯片到PHY芯片的PCS子层。
3. 外环
外环测试要在端口外面构造一个物理环路。电口使用自环头，光口可以用一根光纤连接光模块的TX和RX端。

外环测试中，报文从MAC层发出，经PHY层到达端口外面，再经过外部的物理环路回到MAC。这样，外环测试就覆盖了本地端口的全部功能。

需要注意的是，并非所有的以太网端口都支持外环测试。10GBASE-T的万兆模式，不支持外环测试。对于40G/100G光口而言，端口使用的是一束8根/20根的光纤，外环测试似乎也不太可行。
## 远端环回测试
和本地环回测试相比，远端环回测试的方式恰好相反。端口外接packet generator，packet generator向端口发送报文。端口收到报文之后，报文在端口内部转个圈儿再回来，packet generator发送多少报文就应该收回多少报文。

除了外部PHY和内部PHY，远端环回测试可以检测链路是否存在故障。

1. XS层的远端环回，
报文在外部PHY的XS子层进行环回，再从本端口转发出去。

2. 内部PHY的远端环回
报文在MAC芯片的内部PHY进行环回，再从本端口转发出去。
